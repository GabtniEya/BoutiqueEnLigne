@{
    ViewData["Title"] = "Dashboard";
    Layout = "_LayoutAdmin";
}

<h1 class="page-title">📊 Tableau de Bord</h1>

<!-- Cartes de statistiques -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card card-gradient-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white mb-2">Produits Total</h6>
                        <h2 class="mb-0">@ViewBag.NombreProduits</h2>
                    </div>
                    <div class="stat-icon">📦</div>
                </div>
                <small class="text-white-50">Rupture: @ViewBag.ProduitsRupture | Faible: @ViewBag.ProduitsStockFaible</small>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card card-gradient-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white mb-2">Commandes</h6>
                        <h2 class="mb-0">@ViewBag.NombreCommandes</h2>
                    </div>
                    <div class="stat-icon">🛒</div>
                </div>
                <small class="text-white-50">En cours: @ViewBag.CommandesEnCours</small>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card card-gradient-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white mb-2">Utilisateurs</h6>
                        <h2 class="mb-0">@ViewBag.NombreUtilisateurs</h2>
                    </div>
                    <div class="stat-icon">👥</div>
                </div>
                <small class="text-white-50">Clients inscrits</small>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card card-gradient-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-white mb-2">Chiffre d'Affaires</h6>
                        <h2 class="mb-0">@ViewBag.ChiffreAffaires.ToString("C0")</h2>
                    </div>
                    <div class="stat-icon">💰</div>
                </div>
                <small class="text-white-50">Total des ventes</small>
            </div>
        </div>
    </div>
</div>

<!-- Graphique des ventes (Simple avec CSS) -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">📈 Répartition des Commandes par Statut</h5>
            </div>
            <div class="card-body">
                @{
                    var total = ViewBag.NombreCommandes > 0 ? ViewBag.NombreCommandes : 1;
                    var pourcentageEnCours = (ViewBag.CommandesEnCours * 100.0) / total;
                }
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>En cours</span>
                        <strong>@ViewBag.CommandesEnCours (@pourcentageEnCours.ToString("F1")%)</strong>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar bg-warning" style="width: @pourcentageEnCours%">
                            @ViewBag.CommandesEnCours
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Total Commandes</span>
                        <strong>@ViewBag.NombreCommandes</strong>
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar bg-success" style="width: 100%">
                            @ViewBag.NombreCommandes
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">📦 État des Stocks</h5>
            </div>
            <div class="card-body">
                @{
                    var totalProduits = ViewBag.NombreProduits > 0 ? ViewBag.NombreProduits : 1;
                    var pourcentageRupture = (ViewBag.ProduitsRupture * 100.0) / totalProduits;
                    var pourcentageFaible = (ViewBag.ProduitsStockFaible * 100.0) / totalProduits;
                    var pourcentageOk = 100 - pourcentageRupture - pourcentageFaible;
                }

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>❌ Rupture de stock</span>
                        <strong>@ViewBag.ProduitsRupture</strong>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-danger" style="width: @pourcentageRupture%"></div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>⚠️ Stock faible</span>
                        <strong>@ViewBag.ProduitsStockFaible</strong>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-warning" style="width: @pourcentageFaible%"></div>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>✅ Stock OK</span>
                        <strong>@(ViewBag.NombreProduits - ViewBag.ProduitsRupture - ViewBag.ProduitsStockFaible)</strong>
                    </div>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" style="width: @pourcentageOk%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reste du dashboard inchangé -->
<div class="row">
    <div class="col-md-7 mb-4">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">📋 Dernières Commandes</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>N° Commande</th>
                                <th>Client</th>
                                <th>Date</th>
                                <th>Montant</th>
                                <th>Statut</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var commande in ViewBag.DernieresCommandes)
                            {
                                <tr>
                                    <td><strong>@commande.NumeroCommande</strong></td>
                                    <td>@commande.Utilisateur.Prenom @commande.Utilisateur.Nom</td>
                                    <td>@commande.DateCommande.ToString("dd/MM/yyyy")</td>
                                    <td><strong>@commande.MontantTotal.ToString("C")</strong></td>
                                    <td>
                                        <span class="badge bg-primary">@commande.StatutCommande</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-white text-center">
                <a asp-action="Commandes" class="btn btn-sm btn-outline-primary">Voir toutes les commandes →</a>
            </div>
        </div>
    </div>

    <div class="col-md-5 mb-4">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">🔥 Produits les Plus Vendus</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    @foreach (var produit in ViewBag.ProduitsPopulaires)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            @produit.ProduitNom
                            <span class="badge bg-success rounded-pill">@produit.QuantiteVendue vendus</span>
                        </li>
                    }
                </ul>
            </div>
            <div class="card-footer bg-white text-center">
                <a asp-action="Produits" class="btn btn-sm btn-outline-primary">Gérer les produits →</a>
            </div>
        </div>
    </div>
</div>

<!-- Actions rapides -->
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0">⚡ Actions Rapides</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a asp-action="AjouterProduit" class="btn btn-primary w-100">
                            ➕ Ajouter un Produit
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a asp-action="Produits" class="btn btn-info w-100">
                            📦 Gérer les Produits
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a asp-action="Commandes" class="btn btn-success w-100">
                            🛒 Voir les Commandes
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="/EmailsEnvoyes" target="_blank" class="btn btn-warning w-100">
                            📧 Voir les Emails
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

